# ğŸ“ CVE-2018-20784

## ğŸ” ì·¨ì•½ì  ê°œìš”

**ğŸ”— [ì»¤ë°‹ ë§í¬](https://github.com/php/php-src/commit/0f8cf3b8497dc45c010c44ed9e96518e11e19fc3)**| **ğŸ”— [CVE ë§í¬](https://www.cvedetails.com/cve/CVE-2018-20784/)**

> Linux ì»¤ë„ CFS ìŠ¤ì¼€ì¤„ëŸ¬ì˜ `update_blocked_averages()` í•¨ìˆ˜ ë‚´ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ë£¨í”„ê°€ ë¹„ì •ìƒì ì¸ ë¦¬ìŠ¤íŠ¸ ìƒíƒœ(`rq->leaf_cfs_rq_list`)ì—ì„œ ì¢…ë£Œë˜ì§€ ì•Šê³  **ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ëŠ” DoS ì·¨ì•½ì **ì…ë‹ˆë‹¤.
> ì´ëŠ” ê³ ë¶€í•˜ ìƒí™©ì—ì„œ ì‹œìŠ¤í…œ ì‘ë‹µ ì¤‘ë‹¨, ì»¤ë„ lockup ë“±ì˜ ë¬¸ì œë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì·¨ì•½ì  ì¢…ë¥˜**: \[[CWE-400](https://cwe.mitre.org/data/definitions/400.html)] Uncontrolled Resource Consumption

* **ì·¨ì•½ ì¡°ê±´**: ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ì¤‘ ì œê±°ëœ ì—”íŠ¸ë¦¬ ì ‘ê·¼, `tmp_alone_branch` í¬ì¸í„° ìœ ì§€ ì‹¤íŒ¨
* **Sink**: `for_each_leaf_cfs_rq_safe()` ë§¤í¬ë¡œ ë°˜ë³µë¬¸ ë‚´ ë¬´í•œ ìˆœíšŒ

---

## íƒì§€ ê²°ê³¼ ìš”ì•½

| ì´ ìŠ¬ë¼ì´ìŠ¤ ìˆ˜ | ì·¨ì•½ìœ¼ë¡œ íƒì§€ | ì •ìƒìœ¼ë¡œ íƒì§€ |
| -------- | ------- | ------- |
| 5ê°œ       | 2ê°œ      | 3ê°œ      |

ê·¸ëŸ¬ë‚˜ **ì·¨ì•½ í•¨ìˆ˜ì¸ `update_blocked_averages()` í•¨ìˆ˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ì— í¬í•¨ë˜ì§€ ì•Šì•˜ìœ¼ë©°**, ëª¨ë‘ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì—ì„œ ìƒì„±ëœ `memset()` í˜¸ì¶œ ìŠ¬ë¼ì´ìŠ¤ì…ë‹ˆë‹¤.

---

## âš ï¸ íƒì§€ ê²°ê³¼ ë¬¸ì œì 

1. **í•µì‹¬ ì·¨ì•½ í•¨ìˆ˜ ëˆ„ë½**

   * ì‹¤ì œ ì·¨ì•½í•œ `update_blocked_averages()` í•¨ìˆ˜ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ

2. **ë¬´í•œ ë£¨í”„ êµ¬ì¡° íƒì§€ ì‹¤íŒ¨**

   * `for_each_leaf_cfs_rq_safe()` ë°˜ë³µë¬¸ì´ ì¡°ê±´ ì—†ì´ ìˆœíšŒí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ëª¨ë¸ì´ ì¸ì‹í•˜ì§€ ëª»í•¨

3. **CFS ë¦¬ìŠ¤íŠ¸ êµ¬ì¡° ì´í•´ ë¶€ì¡±**

   * `rq->leaf_cfs_rq_list`ì˜ ë¦¬ìŠ¤íŠ¸ ìƒíƒœê°€ ì†ìƒë  ê²½ìš° ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë°˜ì˜í•˜ì§€ ëª»í•¨

4. **ë¶ˆì¶©ë¶„í•œ ì»¨í…ìŠ¤íŠ¸ ë° íë¦„ ì¶”ì **

   * `tmp_alone_branch` â†’ `leaf_cfs_rq_list` ê°„ì˜ í¬ì¸í„° ì—°ì‚° ê´€ê³„ì™€ ë¦¬ìŠ¤íŠ¸ ì—°ê²° ë¬¸ì œë¥¼ ìŠ¬ë¼ì´ìŠ¤ì— ë‹´ì§€ ëª»í•¨

---


## ğŸ§  ì¶”ê°€ ë¶„ì„ ì •ë³´

---

### ğŸ” Slicer ì¶”ì¶œ ì½”ë“œ

```c
memset(sa, 0, sizeof(*sa));
```

ğŸ“„ **ê·¼ê±°**: \[`slicer_result.json` â€“ idx: 0, Caller: `init_entity_runnable_average`]
í•´ë‹¹ ìŠ¬ë¼ì´ìŠ¤ëŠ” ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ë°˜ë³µë¬¸(`for_each_leaf_cfs_rq_safe`)ì´ë‚˜ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ êµ¬ì¡°ê°€ ì•„ë‹Œ, ë‹¨ìˆœ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ(`memset`)ë§Œ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ì»¤ë„ hangì„ ìœ ë°œí•˜ëŠ” **ë£¨í”„ êµ¬ì¡°, ë¦¬ìŠ¤íŠ¸ ë¬´ê²°ì„±, í¬ì¸í„° ì ‘ê·¼ ë“±ì€ ëª¨ë‘ ìŠ¬ë¼ì´ìŠ¤ì—ì„œ ëˆ„ë½**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

> ìŠ¬ë¼ì´ì„œê°€ ë°˜ë³µë¬¸ ë°”ê¹¥ì˜ ì•ˆì „í•œ í•¨ìˆ˜ë§Œ ì¶”ì¶œí•˜ë©´ì„œ, ìœ„í—˜ íë¦„ì„ ë°˜ì˜í•˜ì§€ ëª»í•˜ëŠ” êµ¬ì¡°ì  ê²°í•¨ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

---

### ğŸ§© í† í°í™”ëœ ì½”ë“œ (ì‹¬ë³¼í™”)

```c
memset(Var2, 0, sizeof(*Var2));
```

ğŸ“„ **ê·¼ê±°**: \[`slicer_result.symbolized.json` â€“ idx: 0, tokenized field]
ì½”ë“œëŠ” `Var2`, `Var1` ë“±ì˜ ì¶”ìƒí™”ëœ ë³€ìˆ˜ëª…ìœ¼ë¡œ ì‹¬ë³¼í™”ë˜ì–´ ìˆìœ¼ë©°, ìœ„í—˜í•œ ì»¨í…ìŠ¤íŠ¸(ì˜ˆ: ë¦¬ìŠ¤íŠ¸ ì‚­ì œ, ë£¨í”„ ì¡°ê±´, ë§¤í¬ë¡œ ê¸°ë°˜ ìˆœíšŒ)ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. êµ¬ì¡°ì ìœ¼ë¡œëŠ” ì¼ë°˜ì ì¸ ì•ˆì „ ì´ˆê¸°í™” íŒ¨í„´ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.

> ì´ë¡œ ì¸í•´ AI ëª¨ë¸ì€ ì½”ë“œë¥¼ ë‹¨ìˆœ ë©”ëª¨ë¦¬ ì´ˆê¸°í™” ë£¨í‹´ìœ¼ë¡œ ì˜ëª» í•´ì„í•  ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.

---

### ğŸ”¤ AI ì…ë ¥ í† í° ì˜ˆì‹œ

```plaintext
<s>, memset, (, Var2, ,, 0, ,, sizeof, (, *, Var2, ), ), ;, if, (, FUNC2, (, Var1, ), ), Var2->memberVar1 = ...
```

ğŸ“„ **ê·¼ê±°**: \[`vectors.json` â€“ id: "0", input\_tokens field]
í† í° ì‹œí€€ìŠ¤ëŠ” `memset()` í˜¸ì¶œì„ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì´í›„ ì¡°ê±´ë¬¸ê³¼ ë©¤ë²„ ì´ˆê¸°í™” êµ¬ë¬¸ì´ ì´ì–´ì§‘ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë£¨í”„, ë§¤í¬ë¡œ, ë¦¬ìŠ¤íŠ¸ ì¡°ì‘ ë“±ì˜ **ì»¤ë„ íŠ¹ìœ ì˜ ë°˜ë³µ ì œì–´ íë¦„ì€ í‘œí˜„ë˜ì§€ ì•ŠìŒ**.

> ë‹¨í¸ì ì¸ í•¨ìˆ˜ í˜¸ì¶œ ì¤‘ì‹¬ì˜ ì‹œí€€ìŠ¤ë¡œ ì¸í•´, AI ëª¨ë¸ì€ ì‹¤ì œ ì·¨ì•½ íŒ¨í„´ì„ ê°ì§€í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ êµ¬ì¡° ì •ë³´ë¥¼ ë°›ì§€ ëª»í•©ë‹ˆë‹¤.

---


## ğŸ§ª ê°œì„  ë°©í–¥ ì œì•ˆ

1. **ì·¨ì•½ í•¨ìˆ˜ ê¸°ë°˜ ìš°ì„  ìŠ¬ë¼ì´ì‹±**

   * ì»¤ë„ ì£¼ìš” ë£¨í‹´(`update_blocked_averages`)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìš°ì„  ìƒì„±í•˜ë„ë¡ ì „ëµ ê°•í™”

2. **ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ê¸°ë°˜ ë£¨í”„ íƒì§€ ê°•í™”**

   * ë°˜ë³µë¬¸ê³¼ í¬ì¸í„° ì¡°ì‘ì´ ê²°í•©ëœ êµ¬ì¡°(`list_for_each_entry_safe`)ì˜ ìœ„í—˜ì„± ì¸ì§€ ê°•í™”

3. **ì»¤ë„ ìë£Œêµ¬ì¡° ë§¥ë½ í•™ìŠµ**

   * `cfs_rq`, `rq`, `leaf_cfs_rq_list` ê°„ ì—°ê³„ê´€ê³„ë¥¼ ëª¨ë¸ì´ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡ í•™ìŠµë°ì´í„° ê°œì„ 

4. **í•¨ìˆ˜ ê°„ ìŠ¬ë¼ì´ìŠ¤ ì—°ê²° ì§€ì›**

   * ë°˜ë³µë¬¸ ë‚´ë¶€ì—ì„œ ë£¨í”„ ì¢…ë£Œì¡°ê±´ì´ ì™¸ë¶€ í¬ì¸í„° ë³€ìˆ˜ì™€ ê´€ë ¨ëœ ê²½ìš° ì´ë¥¼ ì¶”ì í•  ìˆ˜ ìˆëŠ” ë¶„ì„ ê°•í™”

---

## ì·¨ì•½ì  ì„¸ë¶€ ì‚¬í•­

### ğŸ“ ê´€ë ¨ íŒŒì¼ ì†Œê°œ

| íŒŒì¼ëª…      | ì„¤ëª…                  |
| -------- | ------------------- |
| `before_fair.c` | ì·¨ì•½ ì½”ë“œ(ìˆ˜ì • ì „) í¬í•¨ |
| `after_fair.c` | ì·¨ì•½ ì½”ë“œ(ìˆ˜ì • í›„) í¬í•¨ |

---


# ğŸ›¡ï¸ Linux ì»¤ë„ ìŠ¤ì¼€ì¤„ëŸ¬ì˜ ì·¨ì•½ ìˆœíšŒ ë§¤í¬ë¡œ ë¶„ì„ ë° RCU ê¸°ë°˜ ê°œì„ 

## â—ï¸ ì·¨ì•½ ì½”ë“œ ë¶„ì„

```c
for_each_leaf_cfs_rq_safe(rq, cfs_rq, pos) {
    ...
}
```

### ğŸ“Œ ê¸°ìˆ ì  ì„¤ëª…

í•´ë‹¹ ì½”ë“œëŠ” Linux Completely Fair Scheduler(CFS)ì˜ leaf runqueue ìˆœíšŒë¥¼ ìœ„í•œ ë§¤í¬ë¡œ ì¤‘ í•˜ë‚˜ë¡œ, `rq`(runqueue) ë‚´ë¶€ì˜ ê° `cfs_rq`(CFS runqueue) ë¦¬ìŠ¤íŠ¸ ì—”íŠ¸ë¦¬ì— ëŒ€í•´ ë°˜ë³µ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ `*_safe` ì ‘ë¯¸ì–´ì—ë„ ë¶ˆêµ¬í•˜ê³ , ì´ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì‹¬ê°í•œ ê²°í•¨ì„ ë‚´í¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

* `pos` í¬ì¸í„°ë¥¼ ì‚¬ìš©í•œ ìˆœíšŒ êµ¬ì¡°ëŠ” ë¦¬ìŠ¤íŠ¸ê°€ **ì‚­ì œë˜ê±°ë‚˜ ì†ìƒëœ ê²½ìš°**, ë‹¤ìŒ ë…¸ë“œë¡œì˜ ì •ìƒì ì¸ ì´ë™ì„ ë³´ì¥í•˜ì§€ ëª»í•©ë‹ˆë‹¤.
* íŠ¹íˆ CFS êµ¬ì¡° ë‚´ ë¦¬ìŠ¤íŠ¸(`rq->leaf_cfs_rq_list`)ê°€ ì¤‘ê°„ì— ë³€í˜•ë˜ê±°ë‚˜ ë¬´ê²°ì„±ì´ ê¹¨ì§ˆ ê²½ìš°, ë£¨í”„ íƒˆì¶œ ì¡°ê±´ì´ ìƒì‹¤ë˜ì–´ **ë¬´í•œ ë£¨í”„**ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ëŠ” ê²°ê³¼ì ìœ¼ë¡œ **ì»¤ë„ hang**ì´ë‚˜ **soft lockup**ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì‹¤ì œë¡œ ëª‡ëª‡ CVE(Critical Vulnerabilities and Exposures)ì—ì„œë„ ìœ ì‚¬í•œ ì‚¬ë¡€ê°€ ë³´ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.

> âš ï¸ ì¦‰, í•´ë‹¹ ë§¤í¬ë¡œëŠ” **RCU(Read-Copy-Update)** ê¸°ë°˜ì˜ ë™ì‹œì„± ì œì–´ê°€ í•„ìš”í•œ ì»¤ë„ í™˜ê²½ì—ì„œëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## âœ… ê°œì„  ì½”ë“œ: RCU ê¸°ë°˜ ì•ˆì „ ìˆœíšŒ

```c
#define for_each_leaf_cfs_rq(rq, cfs_rq) \
    list_for_each_entry_rcu(cfs_rq, &rq->leaf_cfs_rq_list, leaf_cfs_rq_list)
```

### ğŸ“Œ ê°œì„ ì  ë° êµ¬ì¡°ì  ì•ˆì „ì„± í™•ë³´

ìœ„ ê°œì„  ì½”ë“œëŠ” **RCU ê¸°ë°˜ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ë§¤í¬ë¡œ**ë¡œ, ì»¤ë„ì˜ ë¦¬ìŠ¤íŠ¸ ë¬´ê²°ì„± ì†ìƒ ê°€ëŠ¥ì„±ê³¼ ë™ì‹œì„± ë¬¸ì œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í•´ì†Œí•©ë‹ˆë‹¤:

* `list_for_each_entry_rcu()`ëŠ” RCU ë³´í˜¸ í•˜ì— ì•ˆì „í•œ ìˆœíšŒë¥¼ ì œê³µí•˜ì—¬, ë…¸ë“œ ì‚­ì œë‚˜ ë¦¬ìŠ¤íŠ¸ ë³€í˜• ì‹œì—ë„ **ë©”ëª¨ë¦¬ ì°¸ì¡° ì˜¤ë¥˜ ì—†ì´ ë£¨í”„ íƒˆì¶œì´ ê°€ëŠ¥**í•©ë‹ˆë‹¤.
* ìˆœíšŒ ì¤‘ ì‚­ì œëœ ì—”íŠ¸ë¦¬ì— ì ‘ê·¼í•˜ì§€ ì•Šë„ë¡ RCU grace periodë¥¼ í™œìš©í•˜ë©°, ì´ëŠ” ë‹¤ì¤‘ CPU í™˜ê²½ì—ì„œë„ **ë°ì´í„° ê²½í•© ì¡°ê±´ì„ ë°©ì§€**í•©ë‹ˆë‹¤.
* ê²°ê³¼ì ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ ë‚´ë¶€ì˜ ìˆœíšŒ êµ¬ì¡°ë¥¼ **lockless & deadlock-free**ë¡œ ìœ ì§€í•˜ë©°, **ì •ì§€ ìƒíƒœ(hang), infinite loop, soft lockup** ë“± ì¹˜ëª…ì ì¸ ì»¤ë„ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.

---

## ğŸ” í•µì‹¬ ë¹„êµ ìš”ì•½

| í•­ëª©          | ì·¨ì•½ ì½”ë“œ (`*_safe`)       | ê°œì„  ì½”ë“œ (`RCU ê¸°ë°˜`)               |
| ----------- | ---------------------- | ------------------------------ |
| ìˆœíšŒ ì•ˆì „ì„±      | ë‚®ìŒ (ë¦¬ìŠ¤íŠ¸ ì†ìƒ ì‹œ ë¬´í•œ ë£¨í”„ ê°€ëŠ¥) | ë†’ìŒ (RCU grace periodë¡œ ì•ˆì •ì„± í™•ë³´)  |
| ì»¤ë„ ë™ì‹œì„± ëŒ€ì‘   | ë¯¸í¡                     | ê°•ë ¥ (RCU ë™ê¸°í™”)                   |
| ì»¤ë„ hang ê°€ëŠ¥ì„± | ì¡´ì¬                     | ì œê±°                             |
| ì‚¬ìš© ì‚¬ë¡€       | ë‹¨ìˆœ ìˆœíšŒì— í•œì •              | ì‹¤ì§ˆì ì¸ ì»¤ë„ ìŠ¤ì¼€ì¤„ëŸ¬, ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ë“± ê´‘ë²”ìœ„ ì ìš© |

---

## íƒì§€ ê²°ê³¼

\* cve ì„¤ëª…ì— ë‚˜ì˜¨ ì·¨ì•½í•œ í•¨ìˆ˜(Caller)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ ê´€ë ¨ ë°ì´í„°ë§Œ ì¶”ì¶œ

> ì‹¤ì œ ì·¨ì•½ í•¨ìˆ˜ì¸ `update_blocked_averages()` í•¨ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ëŠ” **í¬í•¨ë˜ì§€ ì•ŠìŒ**
> ì•„ë˜ëŠ” ëª¨ë¸ì´ íƒì§€í•œ ìƒìœ„ 5ê°œ ìŠ¬ë¼ì´ìŠ¤ì…ë‹ˆë‹¤:

| FileName | Caller                          | Source | Sink  | idx | CWE-ID | category       | criterion | line | label | token\_length | predict |
| -------- | ------------------------------- | ------ | ----- | --- | ------ | -------------- | --------- | ---- | ----- | ------------- | ------- |
| before.c | init\_entity\_runnable\_average | False  | False | 0   | CWE-   | CallExpression | memset    | 703  | -3    | 85            | 1       |
| before.c | update\_numa\_stats             | False  | False | 1   | CWE-   | CallExpression | memset    | 1476 | -3    | 95            | 1       |
| before.c | update\_task\_scan\_period      | False  | False | 2   | CWE-   | CallExpression | memset    | 1978 | -3    | 409           | 0       |
| before.c | task\_numa\_fault               | False  | False | 3   | CWE-   | CallExpression | memset    | 2375 | -3    | 419           | 0       |
| before.c | update\_sg\_lb\_stats           | False  | False | 4   | CWE-   | CallExpression | memset    | 8172 | -3    | 390           | 0       |


