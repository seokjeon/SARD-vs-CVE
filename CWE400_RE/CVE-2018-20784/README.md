# ğŸ“ CVE-2018-20784

## ğŸ” ì·¨ì•½ì  ê°œìš”

**ğŸ”— [ì»¤ë°‹ ë§í¬](https://github.com/php/php-src/commit/0f8cf3b8497dc45c010c44ed9e96518e11e19fc3)**| **ğŸ”— [CVE ë§í¬](https://www.cvedetails.com/cve/CVE-2018-20784/)**

> Linux ì»¤ë„ CFS ìŠ¤ì¼€ì¤„ëŸ¬ì˜ `update_blocked_averages()` í•¨ìˆ˜ ë‚´ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ë£¨í”„ê°€ ë¹„ì •ìƒì ì¸ ë¦¬ìŠ¤íŠ¸ ìƒíƒœ(`rq->leaf_cfs_rq_list`)ì—ì„œ ì¢…ë£Œë˜ì§€ ì•Šê³  **ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ëŠ” DoS ì·¨ì•½ì **ì…ë‹ˆë‹¤.
> ì´ëŠ” ê³ ë¶€í•˜ ìƒí™©ì—ì„œ ì‹œìŠ¤í…œ ì‘ë‹µ ì¤‘ë‹¨, ì»¤ë„ lockup ë“±ì˜ ë¬¸ì œë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì·¨ì•½ì  ì¢…ë¥˜**: \[[CWE-400](https://cwe.mitre.org/data/definitions/400.html)] Uncontrolled Resource Consumption

* **Source**: CFS ëŸ°í ë¦¬ìŠ¤íŠ¸(`leaf_cfs_rq_list`)ì˜ ë¹„ì •ìƒ ì¡°ì‘ ë˜ëŠ” ì •ë ¬ ìˆœì„œ ì˜¤ë¥˜
* **ì·¨ì•½ ì¡°ê±´**: ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ì¤‘ ì œê±°ëœ ì—”íŠ¸ë¦¬ ì ‘ê·¼, `tmp_alone_branch` í¬ì¸í„° ìœ ì§€ ì‹¤íŒ¨
* **Sink**: `for_each_leaf_cfs_rq_safe()` ë§¤í¬ë¡œ ë°˜ë³µë¬¸ ë‚´ ë¬´í•œ ìˆœíšŒ

---

## íƒì§€ ê²°ê³¼ ìš”ì•½

| ì´ ìŠ¬ë¼ì´ìŠ¤ ìˆ˜ | ì·¨ì•½ìœ¼ë¡œ íƒì§€ | ì •ìƒìœ¼ë¡œ íƒì§€ |
| -------- | ------- | ------- |
| 5ê°œ       | 2ê°œ      | 3ê°œ      |

ê·¸ëŸ¬ë‚˜ **ì·¨ì•½ í•¨ìˆ˜ì¸ `update_blocked_averages()` í•¨ìˆ˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ì— í¬í•¨ë˜ì§€ ì•Šì•˜ìœ¼ë©°**, ëª¨ë‘ ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì—ì„œ ìƒì„±ëœ `memset()` í˜¸ì¶œ ìŠ¬ë¼ì´ìŠ¤ì…ë‹ˆë‹¤.

---

## âš ï¸ íƒì§€ ê²°ê³¼ ë¬¸ì œì 

1. **í•µì‹¬ ì·¨ì•½ í•¨ìˆ˜ ëˆ„ë½**

   * ì‹¤ì œ ì·¨ì•½í•œ `update_blocked_averages()` í•¨ìˆ˜ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ

2. **ë¬´í•œ ë£¨í”„ êµ¬ì¡° íƒì§€ ì‹¤íŒ¨**

   * `for_each_leaf_cfs_rq_safe()` ë°˜ë³µë¬¸ì´ ì¡°ê±´ ì—†ì´ ìˆœíšŒí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¥¼ ëª¨ë¸ì´ ì¸ì‹í•˜ì§€ ëª»í•¨

3. **CFS ë¦¬ìŠ¤íŠ¸ êµ¬ì¡° ì´í•´ ë¶€ì¡±**

   * `rq->leaf_cfs_rq_list`ì˜ ë¦¬ìŠ¤íŠ¸ ìƒíƒœê°€ ì†ìƒë  ê²½ìš° ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë°˜ì˜í•˜ì§€ ëª»í•¨

4. **ë¶ˆì¶©ë¶„í•œ ì»¨í…ìŠ¤íŠ¸ ë° íë¦„ ì¶”ì **

   * `tmp_alone_branch` â†’ `leaf_cfs_rq_list` ê°„ì˜ í¬ì¸í„° ì—°ì‚° ê´€ê³„ì™€ ë¦¬ìŠ¤íŠ¸ ì—°ê²° ë¬¸ì œë¥¼ ìŠ¬ë¼ì´ìŠ¤ì— ë‹´ì§€ ëª»í•¨

---

## ğŸ§  ì¶”ê°€ ë¶„ì„ ì •ë³´

### ğŸ” Slicer ì¶”ì¶œ ì½”ë“œ

> ì·¨ì•½ í•¨ìˆ˜ `update_blocked_averages()`ëŠ” ìŠ¬ë¼ì´ìŠ¤ì— í¬í•¨ë˜ì§€ ì•Šì•˜ìœ¼ë©°, ë¶„ì„ ê°€ëŠ¥í•œ ì½”ë“œëŠ” ì—†ìŒ

---

### ğŸ§© í† í°í™”ëœ ì½”ë“œ (ì˜ˆì‹œ)

```c
memset(&entity->avg, 0, sizeof(struct sched_avg));
```

* ìŠ¬ë¼ì´ìŠ¤ëŠ” `memset()` ê¸°ë°˜ ë‹¨ìˆœ ì´ˆê¸°í™” ë£¨í‹´ë§Œ í¬í•¨ë¨
* `cfs_rq_list` ë˜ëŠ” ë°˜ë³µë¬¸ì€ ì „í˜€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ

---

### ğŸ”¤ AI ì…ë ¥ í† í° ì˜ˆì‹œ

```
<s>, memset, (, Var1, ,, 0, ,, sizeof, (, struct, sched_avg, ), ), ;, </s>
```

* ë‹¨ì¼ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œë¡œ, ë°˜ë³µ êµ¬ì¡°ë‚˜ ë¦¬ìŠ¤íŠ¸ ì—°ì‚°ì´ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŒ

---

## ğŸ§ª ê°œì„  ë°©í–¥ ì œì•ˆ

1. **ì·¨ì•½ í•¨ìˆ˜ ê¸°ë°˜ ìš°ì„  ìŠ¬ë¼ì´ì‹±**

   * ì»¤ë„ ì£¼ìš” ë£¨í‹´(`update_blocked_averages`)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìš°ì„  ìƒì„±í•˜ë„ë¡ ì „ëµ ê°•í™”

2. **ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ ê¸°ë°˜ ë£¨í”„ íƒì§€ ê°•í™”**

   * ë°˜ë³µë¬¸ê³¼ í¬ì¸í„° ì¡°ì‘ì´ ê²°í•©ëœ êµ¬ì¡°(`list_for_each_entry_safe`)ì˜ ìœ„í—˜ì„± ì¸ì§€ ê°•í™”

3. **ì»¤ë„ ìë£Œêµ¬ì¡° ë§¥ë½ í•™ìŠµ**

   * `cfs_rq`, `rq`, `leaf_cfs_rq_list` ê°„ ì—°ê³„ê´€ê³„ë¥¼ ëª¨ë¸ì´ ì¸ì§€í•  ìˆ˜ ìˆë„ë¡ í•™ìŠµë°ì´í„° ê°œì„ 

4. **í•¨ìˆ˜ ê°„ ìŠ¬ë¼ì´ìŠ¤ ì—°ê²° ì§€ì›**

   * ë°˜ë³µë¬¸ ë‚´ë¶€ì—ì„œ ë£¨í”„ ì¢…ë£Œì¡°ê±´ì´ ì™¸ë¶€ í¬ì¸í„° ë³€ìˆ˜ì™€ ê´€ë ¨ëœ ê²½ìš° ì´ë¥¼ ì¶”ì í•  ìˆ˜ ìˆëŠ” ë¶„ì„ ê°•í™”

---

## ì·¨ì•½ì  ì„¸ë¶€ ì‚¬í•­

### ğŸ“ ê´€ë ¨ íŒŒì¼ ì†Œê°œ

| íŒŒì¼ëª…      | ì„¤ëª…                  |
| -------- | ------------------- |
| `fair.c` | ì»¤ë„ ìŠ¤ì¼€ì¤„ë§ ê´€ë ¨ í•¨ìˆ˜ ì •ì˜    |
| `diff.c` | ì·¨ì•½ ì½”ë“œ íŒ¨ì¹˜ diff í¬í•¨ íŒŒì¼ |

---

### â—ï¸ ì·¨ì•½ ì½”ë“œ

```c
for_each_leaf_cfs_rq_safe(rq, cfs_rq, pos) {
    ...
}
```

* ë¦¬ìŠ¤íŠ¸ ì—”íŠ¸ë¦¬ ì œê±° ë˜ëŠ” í¬ì¸í„° ì†ìƒ ì‹œ ë°˜ë³µë¬¸ íƒˆì¶œ ë¶ˆê°€
* ê²°ê³¼ì ìœ¼ë¡œ ì»¤ë„ hang ë°œìƒ

---

### âœ… ê°œì„  ì½”ë“œ

```c
#define for_each_leaf_cfs_rq(rq, cfs_rq) \
    list_for_each_entry_rcu(cfs_rq, &rq->leaf_cfs_rq_list, leaf_cfs_rq_list)
```

* ë¶ˆì™„ì „í•œ ìˆœíšŒ ë§¤í¬ë¡œë¥¼ ì œê±°í•˜ê³ , RCU ê¸°ë°˜ ì•ˆì „ ìˆœíšŒ êµ¬ì¡°ë¡œ ëŒ€ì²´
* ë¦¬ìŠ¤íŠ¸ ì†ìƒ ì‹œ ë£¨í”„ íƒˆì¶œ ì‹¤íŒ¨ ë¬¸ì œë¥¼ êµ¬ì¡°ì ìœ¼ë¡œ ì°¨ë‹¨

---

## íƒì§€ ê²°ê³¼

\* cve ì„¤ëª…ì— ë‚˜ì˜¨ ì·¨ì•½í•œ í•¨ìˆ˜(Caller)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ ê´€ë ¨ ë°ì´í„°ë§Œ ì¶”ì¶œ

> ì‹¤ì œ ì·¨ì•½ í•¨ìˆ˜ì¸ `update_blocked_averages()` í•¨ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ëŠ” **í¬í•¨ë˜ì§€ ì•ŠìŒ**
> ì•„ë˜ëŠ” ëª¨ë¸ì´ íƒì§€í•œ ìƒìœ„ 5ê°œ ìŠ¬ë¼ì´ìŠ¤ì…ë‹ˆë‹¤:

| FileName | Caller                          | Source | Sink  | idx | CWE-ID | category       | criterion | line | label | token\_length | predict |
| -------- | ------------------------------- | ------ | ----- | --- | ------ | -------------- | --------- | ---- | ----- | ------------- | ------- |
| before.c | init\_entity\_runnable\_average | False  | False | 0   | CWE-   | CallExpression | memset    | 703  | -3    | 85            | 1       |
| before.c | update\_numa\_stats             | False  | False | 1   | CWE-   | CallExpression | memset    | 1476 | -3    | 95            | 1       |
| before.c | update\_task\_scan\_period      | False  | False | 2   | CWE-   | CallExpression | memset    | 1978 | -3    | 409           | 0       |
| before.c | task\_numa\_fault               | False  | False | 3   | CWE-   | CallExpression | memset    | 2375 | -3    | 419           | 0       |
| before.c | update\_sg\_lb\_stats           | False  | False | 4   | CWE-   | CallExpression | memset    | 8172 | -3    | 390           | 0       |

---

í•„ìš”í•˜ì‹œë©´ ì´ ë³´ê³ ì„œë¥¼ PDF, HTML ë˜ëŠ” GitHub ì •ì  í˜ì´ì§€ë¡œë„ ë³€í™˜í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
