# ğŸ“ CVE-2019-12973

## ğŸ” ì·¨ì•½ì  ê°œìš”

ğŸ”— [ì»¤ë°‹ ë§í¬](https://github.com/uclouvain/openjpeg/commit/48fa2043614d6f90b8d8d6c5f2fcb483c6a7a469) | ğŸ”— [CVE ë§í¬](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12973) | ğŸ”— [CWE ë§í¬ (CWE-400)](https://cwe.mitre.org/data/definitions/400.html)

OpenJPEGì˜ BMP ë””ì½”ë” í•¨ìˆ˜ `bmp_read_rle8_data()`ì—ì„œ,
ì¡°ì‘ëœ RLE ì••ì¶• ëª…ë ¹ê³¼ ì˜ëª»ëœ `width`, `height` ê°’ì„ í†µí•´ ë£¨í”„ ì¢…ë£Œ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì§€ ì•Šì•„
**ë¬´í•œ ë£¨í”„**ì— ë¹ ì§€ëŠ” **ì„œë¹„ìŠ¤ ê±°ë¶€(DoS)** ì·¨ì•½ì ì…ë‹ˆë‹¤.

* **ì·¨ì•½ì  ì¢…ë¥˜:** \[CWE-400] Uncontrolled Resource Consumption
* **ì·¨ì•½ ì¡°ê±´:** BMP íŒŒì¼ í—¤ë”ì˜ width, height í•„ë“œë¥¼ ì¡°ì‘í•˜ì—¬ RLE ì••ì¶• ëª…ë ¹ ì‹œí€€ìŠ¤ê°€ ì •ìƒ ì¢…ë£Œë˜ì§€ ì•ŠìŒ
* **Sink:** ë£¨í”„ `while (y < height)` ë‚´ `getc(IN)` í˜¸ì¶œì´ ë¬´í•œ ë°˜ë³µë˜ì–´ ë¦¬ì†ŒìŠ¤ ì†Œë¹„

---

## íƒì§€ ê²°ê³¼ ìš”ì•½

CVE ì„¤ëª…ì— ê¸°ë°˜í•˜ì—¬ `bmp_read_rle8_data()` í•¨ìˆ˜ ì¤‘ì‹¬ìœ¼ë¡œ ìŠ¬ë¼ì´ìŠ¤ë¥¼ ìˆ˜ì§‘í•œ ê²°ê³¼:

| ì´ ìŠ¬ë¼ì´ìŠ¤ ìˆ˜ | ì·¨ì•½ìœ¼ë¡œ íƒì§€ | ì •ìƒìœ¼ë¡œ íƒì§€ |
| :------: | :-----: | :-----: |
|   196ê°œ   |    0ê°œ   |   196ê°œ  |

* `bmp_read_rle8_data()` í•¨ìˆ˜ ë‚´ ë£¨í”„(`while (y < height)`)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ëŠ” ì¡´ì¬í–ˆìœ¼ë‚˜,
  ëª¨ë“  ìŠ¬ë¼ì´ìŠ¤ê°€ ì •ìƒìœ¼ë¡œ íŒì •ë¨.

| FileName             | Caller                  | Source |  Sink | idx | CWE-ID |    category    | criterion | line | label | token\_length | predict |
| :------------------- | :---------------------- | :----: | :---: | :-: | :----: | :------------: | :-------: | :--: | :---: | :-----------: | :-----: |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  0  |  CWE-  | CallExpression |    getc   |  330 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  1  |  CWE-  | CallExpression |    getc   |  331 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  2  |  CWE-  | CallExpression |  fprintf  |  334 |   -3  |       23      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  3  |  CWE-  | CallExpression |    getc   |  340 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  4  |  CWE-  | CallExpression |    getc   |  341 |   -3  |      343      |    0    |

---

## SARDëŠ” ì˜ íƒì§€í•˜ëŠ”ë° ì´ CVEëŠ” íƒì§€ ëª»í–ˆë˜ ì´ìœ 

**ì„¸ ê°€ì§€ ê´€ì ì—ì„œ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

1. **ìŠ¬ë¼ì´ìŠ¤ ì¶”ì¶œ ë²”ìœ„ ë¶ˆì™„ì „**

   * ìŠ¬ë¼ì´ìŠ¤ê°€ `getc()` í˜¸ì¶œ ë˜ëŠ” ì£¼ë³€ ì½”ë“œ ì¼ë¶€ë§Œ í¬í•¨í•˜ê³ ,
     `while (y < height)` ë£¨í”„ êµ¬ì¡°ì™€ `y` ì¦ê°€ ì œì–´ íë¦„ì€ í¬í•¨ë˜ì§€ ì•ŠìŒ.

   * ê¸°ëŒ€í•˜ëŠ” ìŠ¬ë¼ì´ìŠ¤ ì˜ˆì‹œ:

     ```c
     while (y < height) {
         int c = getc(IN);
         written++;
     }
     ```

   * ì‹¤ì œ ìŠ¬ë¼ì´ìŠ¤:

     ```c
     int c = getc(IN);
     ```

2. **ë£¨í”„ ì¡°ê±´ ë³€ìˆ˜ ì¶”ì  ì‹¤íŒ¨**

   * ë£¨í”„ ì¢…ë£Œ ì¡°ê±´(`y < height`)ì— í•„ìš”í•œ `height` ë³€ìˆ˜ëŠ” BMP íŒŒì¼ í—¤ë”ì—ì„œ ìœ ë˜í•œ ì™¸ë¶€ ì…ë ¥.
   * `y`ëŠ” ë£¨í”„ ë‚´ RLE ëª…ë ¹ ì²˜ë¦¬ ë¡œì§ì— ì˜í•´ ì¦ê°€í•˜ëŠ”ë°,
     íŠ¹ì • ë¹„ì •ìƒ RLE ëª…ë ¹ ì¡°í•© ì‹œ `y`ê°€ ì¦ê°€í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒ.
   * ìŠ¬ë¼ì´ìŠ¤ê°€ `y`, `height` ê°„ì˜ ê´€ê³„ì™€ ë£¨í”„ ì œì–´ í”Œë¡œìš°ë¥¼ í¬ì°©í•˜ì§€ ëª»í•¨.

3. **íƒì§€ ëª¨ë¸ ì…ë ¥ ì •ë³´ ë¶€ì¡±**

   * `vectors.json` ë¶„ì„ ê²°ê³¼, ìŠ¬ë¼ì´ìŠ¤ ë²¡í„°ëŠ” `getc()` í˜¸ì¶œ ì¤‘ì‹¬ì˜ ë‹¨í¸ì ì¸ ì‹œí€€ìŠ¤ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŒ.
   * ë£¨í”„ ì œì–´ í”Œë¡œìš°, ë°˜ë³µ ì¡°ê±´, ì™¸ë¶€ ì…ë ¥ ë³€ìˆ˜ ê°„ ê´€ê³„ê°€ í¬í•¨ë˜ì§€ ì•Šì•„ ëª¨ë¸ì´ ë¬´í•œ ë£¨í”„ ìœ„í—˜ì„ ì¸ì‹í•  ìˆ˜ ì—†ìŒ.

---

## ğŸ“ ê´€ë ¨ íŒŒì¼ ì†Œê°œ

| íŒŒì¼ëª…                   | ì„¤ëª…             |
| :-------------------- | :------------- |
| `before_convertbmp.c` | ì·¨ì•½ ì½”ë“œ(ìˆ˜ì • ì „) í¬í•¨ |
| `after_convertbmp.c`  | ê°œì„  ì½”ë“œ(ìˆ˜ì • í›„) í¬í•¨ |

---

## â—ï¸ ì·¨ì•½ ì½”ë“œ

ğŸ“„ **Source:** BMP í—¤ë”ì—ì„œ ì…ë ¥ëœ `height` ê°’ (`before_convertbmp.c:546`)
ğŸ“„ **Sink:** ë¬´í•œ ë°˜ë³µ `getc(IN)` í˜¸ì¶œ (`before_convertbmp.c:547`)

```c
while (y < height) {               // (Line 546) Loop condition
    int c = getc(IN);               // (Line 547) Uncontrolled resource consumption
    ...
}
```

### ğŸ“Œ ì·¨ì•½ íë¦„ ì„¤ëª…

* `height` ê°’ì€ BMP íŒŒì¼ì˜ í—¤ë”ì—ì„œ ìœ ë˜í•œ ì™¸ë¶€ ì…ë ¥.
* ë£¨í”„ ì§„í–‰ ë³€ìˆ˜ `y`ëŠ” ë£¨í”„ ë‚´ ëª…ë ¹ì–´ í•´ì„ì— ë”°ë¼ ì¦ê°€í•´ì•¼ ì •ìƒ ì¢…ë£Œ ê°€ëŠ¥.
* ì¡°ì‘ëœ RLE ì••ì¶• ëª…ë ¹ì„ í†µí•´ `y` ì¦ê°€ê°€ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©´,
  ë£¨í”„ ì¢…ë£Œ ì¡°ê±´(`y < height`)ì´ ì˜êµ¬íˆ ì°¸(True)ìœ¼ë¡œ ìœ ì§€ë˜ì–´ ë¬´í•œ ë°˜ë³µ ë°œìƒ.
* ì´ë¡œ ì¸í•´ **CPU ë° ë©”ëª¨ë¦¬ ìì›ì´ ë¬´ì œí•œ ì†Œëª¨**ë˜ì–´ ì„œë¹„ìŠ¤ ê±°ë¶€(DoS) ìƒíƒœì— ë¹ ì§ˆ ìˆ˜ ìˆìŒ.

---

## âœ… ê°œì„  ì½”ë“œ

ğŸ“„ **íŒ¨ì¹˜ ìœ„ì¹˜:** `after_convertbmp.c:610`

```c
if (written != width * height) {
    fprintf(stderr, "warning, image's actual size does not match advertised one\n");
    return OPJ_FALSE;
}
```

### ğŸ“Œ ê°œì„  ë°©ë²•

* ë£¨í”„ ì§„í–‰ ì¤‘ ë””ì½”ë”©ëœ í”½ì…€ ìˆ˜ë¥¼ `written`ìœ¼ë¡œ ì¹´ìš´íŒ….
* ë£¨í”„ ì¢…ë£Œ í›„, ê¸°ë¡ëœ í”½ì…€ ìˆ˜ `written`ê³¼ í—¤ë”ì— ëª…ì‹œëœ ì´ í”½ì…€ ìˆ˜ `width * height`ë¥¼ ë¹„êµ.
* ë¶ˆì¼ì¹˜ ì‹œ ì˜¤ë¥˜ ë°˜í™˜(`return OPJ_FALSE`)ìœ¼ë¡œ ë””ì½”ë”© ì‹¤íŒ¨ ì²˜ë¦¬.
* ì¡°ì‘ëœ BMP íŒŒì¼ì´ ë¬´í•œ ë£¨í”„ë¥¼ ìœ ë°œí•˜ëŠ” ê²ƒì„ ì‚¬ì „ì— ì°¨ë‹¨.

---

## ğŸ§ª íƒì§€ ê²°ê³¼ (ìŠ¬ë¼ì´ìŠ¤ ìƒì„¸)

*CVE ì„¤ëª…ì— ë‚˜ì˜¨ ì·¨ì•½í•œ í•¨ìˆ˜(`Caller`)ì— ëŒ€í•œ ìŠ¬ë¼ì´ìŠ¤ ê´€ë ¨ ë°ì´í„°ë§Œ ì¶”ì¶œ.*

| FileName             | Caller                  | Source |  Sink | idx | CWE-ID |    category    | criterion | line | label | token\_length | predict |
| :------------------- | :---------------------- | :----: | :---: | :-: | :----: | :------------: | :-------: | :--: | :---: | :-----------: | :-----: |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  0  |  CWE-  | CallExpression |    getc   |  330 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  1  |  CWE-  | CallExpression |    getc   |  331 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  2  |  CWE-  | CallExpression |  fprintf  |  334 |   -3  |       23      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  3  |  CWE-  | CallExpression |    getc   |  340 |   -3  |      343      |    0    |
| before\_convertbmp.c | bmp\_read\_file\_header |  False | False |  4  |  CWE-  | CallExpression |    getc   |  341 |   -3  |      343      |    0    |


