# CWE-78: OS ëª…ë ¹ì–´ ì‚½ì… (OS Command Injection)

## ğŸ“Œ ê°œìš”  
CWE-78ì€ **ìš´ì˜ ì²´ì œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ ì™¸ë¶€ ì…ë ¥ê°’ì„ ì ì ˆíˆ ê²€ì¦í•˜ì§€ ì•Šì•„**  
ê³µê²©ìê°€ ì•…ì˜ì ì¸ ëª…ë ¹ì–´ë¥¼ ì‚½ì…í•˜ê±°ë‚˜ ë³€ì¡°í•˜ì—¬  
ì‹œìŠ¤í…œì—ì„œ ì˜ë„í•˜ì§€ ì•Šì€ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë„ë¡ ë§Œë“œëŠ” ì·¨ì•½ì ì…ë‹ˆë‹¤.

ì´ ì˜ˆì œëŠ” **SPICE í”„ë¡œì íŠ¸ì˜ vd_agent ì»´í¬ë„ŒíŠ¸**ì—ì„œ ë°œìƒí•œ  
[CVE-2017-15108 (commit: 8ba174816d245757e743e636df357910e1d5eb61)]ì˜  
íŒ¨ì¹˜ ì´ì „ ë²„ì „ì„ ê·¸ëŒ€ë¡œ ë¤í”„í•œ ì½”ë“œì…ë‹ˆë‹¤.  
**íŒŒì¼ ì „ì†¡ ì™„ë£Œ í›„ ì €ì¥ ë””ë ‰í† ë¦¬ë¥¼ ì—¬ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•œ ì‰˜ ì¸ì ì…˜ ì·¨ì•½ì **ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## ğŸ›  ì£¼ìš” ì›ì¸  

- ì™¸ë¶€ ì…ë ¥ì¸ `xfers->save_dir` ê²½ë¡œë¥¼ ëª…ë ¹ì–´ ë¬¸ìì—´ë¡œ ì¡°í•©  
- `snprintf()`ë¥¼ í†µí•´ `system()` í•¨ìˆ˜ë¡œ ì „ë‹¬ â†’ **ì‰˜ í•´ì„ ë°œìƒ**
- ì…ë ¥ ê²€ì¦ ì—†ì´ ì‰˜ ëª…ë ¹ì–´ ì‹¤í–‰ì— í¬í•¨ë¨ â†’ **ëª…ë ¹ì–´ ì‚½ì… ê°€ëŠ¥**

---

## ğŸ“‚ í¬í•¨ëœ íŒŒì¼  

| íŒŒì¼ëª… | ì„¤ëª… |
|--------|------|
| `file-xfers.c` | SPICE í”„ë¡œì íŠ¸ì˜ vd_agent ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì „ì²´ ì†ŒìŠ¤ì½”ë“œ (íŒ¨ì¹˜ ì „ ë²„ì „) |

---

## ğŸš¨ ì·¨ì•½ ì½”ë“œ (BadSink)  

ğŸ“Œ **ë°œìƒ ìœ„ì¹˜**: `file-xfers.c`  
ğŸ“Œ **í•¨ìˆ˜**: `vdagent_file_xfers_data(...)`  
ğŸ“Œ **íŒ¨ì¹˜ ì „ ì½”ë“œ**:
```c
char buf[PATH_MAX];
snprintf(buf, PATH_MAX, "xdg-open '%s'&", xfers->save_dir); // âŒ ì‰˜ ëª…ë ¹ì–´ ì¡°í•©
status = system(buf); // âŒ CWE-78: ëª…ë ¹ì–´ ì‚½ì… ê°€ëŠ¥
```

ğŸ“Œ **ë¬¸ì œì  ìš”ì•½**:
- ê³µê²©ìê°€ `save_dir` ê°’ì— ì‰˜ ì œì–´ ë¬¸ìë¥¼ ì‚½ì…í•˜ë©´ ì‹œìŠ¤í…œ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŒ  
- ì˜ˆ: `xfers->save_dir = "/safe/dir; rm -rf /"` â†’ ì „ì²´ ì‹œìŠ¤í…œ ì‚­ì œ ìœ„í—˜  
- `system()`ì€ ë¬¸ìì—´ ì „ì²´ë¥¼ ì‰˜ì— ë„˜ê¸°ë¯€ë¡œ **ì ˆëŒ€ ì‚¬ìš©ì„ í”¼í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜**  

---

## âœ… íŒ¨ì¹˜ ì´í›„ ë³€ê²½ ì‚¬í•­ ìš”ì•½

- `system()` ì‚¬ìš© ì œê±°
- `g_spawn_async()` í•¨ìˆ˜ë¡œ êµì²´í•˜ì—¬ ëª…ë ¹ì–´ì™€ ì¸ìë¥¼ ëª…í™•íˆ ë¶„ë¦¬
- ì‰˜ í•´ì„ì„ íšŒí”¼í•˜ì—¬ ì…ë ¥ê°’ì— ëŒ€í•œ ì•ˆì „ì„± í™•ë³´

---

## ğŸ“š ì°¸ê³  ì •ë³´

- ğŸ”— [ê³µì‹ ì»¤ë°‹ ë§í¬](https://cgit.freedesktop.org/spice/linux/vd_agent/commit/?id=8ba174816d245757e743e636df357910e1d5eb61)
- ğŸ“– CWE Reference: [CWE-78 on MITRE](https://cwe.mitre.org/data/definitions/78.html)

---